<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
      <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.min.css">

      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://*;">
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
         <style media="screen">
        /* Style inputs */
             input[type=text], input[type=email], textarea {
          width: 100%;
          padding: 12px 20px;
          margin: 8px 0;
          display: inline-block;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;
          background-color: aliceblue;
        }
        
        /* OVERRIDE for Date/Time Inputs to keep them compact */
        .datetime-input, .time-input, .date-only-input {
            width: auto !important; 
            display: inline-block !important;
            background-color: white !important;
            cursor: pointer;
        }

        /* --- UPDATED CSS: WIDER TIME / REMOVED GAP --- */
        .xdsoft_datetimepicker .xdsoft_timepicker {
            width: 75px !important; 
        }
        .xdsoft_datetimepicker .xdsoft_datepicker {
            margin-right: 0 !important; 
        }

/* --- CALENDAR ICON LOGIC --- */

        /* 1. Add extra padding to the right so text doesn't cover the icon area */
        .datetime-input, .date-only-input, .time-input {
            padding-right: 30px !important;
        }

        /* 2. Show Icon ONLY when placeholder is visible (Value is empty) */
        .datetime-input:placeholder-shown, 
        .date-only-input:placeholder-shown,
        .time-input:placeholder-shown {
            /* This is a standard Calendar Icon encoded as a background image */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 8px center; /* Position: 8px from right side */
            background-size: 18px; /* Size of the icon */
        }
        /* --------------------------------------------- */

/* --- DATE PICKER POPUP COLORS --- */
        
        /* 1. Set the background color of the whole popup to #d1f4f5 */
        .xdsoft_datetimepicker,
        .xdsoft_datetimepicker .xdsoft_datepicker,
        .xdsoft_datetimepicker .xdsoft_timepicker {
            background-color: #d1f4f5 !important;
        }

       /* 2. Make the "Clear Date" option look like a real button */
        .xdsoft_clear_btn {
            /* Layout: This forces it to be smaller than the container */
            display: block !important;
            width: 85% !important;        /* 85% width so it doesn't touch edges */
            margin: 10px auto !important; /* 'auto' centers it left/right */
            padding: 8px 0 !important;    /* Internal spacing for the text */
            
            /* Visuals: Colors and Shapes */
            background-color: #f44336 !important; /* Red */
            color: white !important;
            border-radius: 20px !important;       /* Rounded "pill" corners */
            
            /* Text & Interaction */
            text-align: center;
            font-weight: bold;
            font-size: 11px;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2); /* Subtle drop shadow */
            border: none !important;
            
            /* Placement */
            clear: both; /* Ensures it sits below the calendar/time columns */
        }
        
        .xdsoft_clear_btn:hover {
            background-color: #d32f2f !important; /* Darker red on hover */
            transform: translateY(-1px);          /* Slight lift effect */
        }

        /* 3. Ensure Month/Year text is visible on the light blue background */
        .xdsoft_datetimepicker .xdsoft_label {
            background-color: transparent !important;
            color: black !important;
        }

        /* Style the submit button */
        button {
          width: 100%;
          background-color: #4CAF50;
          color: white;
          padding: 14px 20px;
          margin: 8px 0;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: large;
        }
        
         button2 {
          width: 50%;
          background-color: #4CAF50;
          color: white;
          padding: 14px 20px;
          margin: 8px 0;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: large;
        }

        
        /* Add a background color to the submit button on mouse-over */
        input[type=submit]:hover {
          background-color: #45a049;
        }
        table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}
	      
td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
.weekDays-selector input {
  display: none!important;
}

.weekDays-selector input[type=checkbox] + label {
  display: inline-block;
  border-radius: 6px;
  background: #dddddd;
  height: 40px;
  width: 30px;
  margin-right: 3px;
  line-height: 40px;
  text-align: center;
  cursor: pointer;
}

.weekDays-selector input[type=checkbox]:checked + label {
  background: #2AD705;
  color: #ffffff;
}
      </style>  
    <title>Aqua Visitor Managment System</title>
<link href="https://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css" rel="stylesheet"/>
  </head>
<div id="loading">
  <body style="font-family: sans-serif;font-size: large;">
      <a href="https://aquavisitorsystem.github.io/"><img id="logo" src="aqua.png" width="250px" alt="Go Home"></a><br>
      <h1 id="header" style="text-align: center;">Aqua Visitor Management System</h1>
      <div id="help"><center> <button onclick="location.href='https://aquavisitorsystem.github.io/help/help.html'" type="button" style="width: 120px;padding: unset;background-color: grey;">help</button>  <button type="button" onclick="javascript:callback()" style="width: 120px;padding: unset;background-color: grey;">what's new?</button></center></div>
      <div id="back"><center><a href="javascript:history.back();">[Go Back]</a></center></div>  
      <button id="schedule" type="button" style="background-color: orangered;">Schedule Visitor</button>
       <button id="getall" type="button" style="background-color: navy;">View Scheduled Visits</button>
       <div id="container">
    <form id="forms">
      <input type="hidden" id="bitly" name="bitly">  
      <input type="hidden" id="id" name="id"> 
     <div id="checkedin"></div>
      <div id="logins">
          <datalist id="loginlist"></datalist>
       <label for="login" id="loginlabel" style="color: black;font-weight: bold;">Aqua Employee Guest is Visiting (Aqua UserID)</label><br>
<input list="loginlist" type="text" id="login" name="login" placeholder="Enter aqua userid | example:ckonkol" style="background-color: lightyellow;width: 600px;text-transform: lowercase;"><label id="emaillabel" style="color: black;font-weight: bold;">@aqua-aerobic.com</label>
      </div>
	  
	<div id="meetingfields">
    <label for="fname" style="color: black;font-weight: bold;">Guest First Name</label>
    <input type="text" id="fname" name="fname" placeholder="Enter guest first name or Company Name if name TBD (Example: WKRP Radio)" style="text-transform: uppercase;">

    <label for="lname" style="color: black;font-weight: bold;">Guest Last Name</label>
    <input type="text" id="lname" name="lname" placeholder="Enter guest last name or Guest(#) if name TBD. (Examples: GUEST, GUEST1, GUEST2, etc.)" style="text-transform: uppercase;">

    <label for="cname" style="color: black;font-weight: bold;">Guest Company Name</label>
    <input type="text" id="cname" name="cname" placeholder="Enter guest company name or GUEST" style="text-transform: uppercase;">

    <label for="email" style="color: black;font-weight: bold;">Guest Email</label>
    <input type="email" id="email" name="email" placeholder="Enter guest email address or TBD" style="text-transform: uppercase;">
    <br>

    <div id="datedetails">
        <label for="date_visual" style="color: black;font-weight: bold;">Date & Time Guest is Visiting Aqua: </label>
        
        <input type="hidden" id="date" name="date">
        <input type="text" id="date_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
        
        <i style="color: gray;"> If time unknown use 8:00am</i>

        <details>
            <summary style="cursor: pointer; padding: 5px; background-color: #f0f0f0;">[Click to add more dates OR Weekly Recurring Dates]</summary>
            <br>
            <b>Individual Dates</b><br />
            <i style="font-size: small;">If you select individual dates you cannot use below <b>Weekly Recurring Dates</b></i><br />
            
            <ul>Date 2:&nbsp;&nbsp;&nbsp;
                <input type="hidden" id="date2" name="date2">
                <input type="text" id="date2_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
            </ul>
            <ul>Date 3:&nbsp;&nbsp;&nbsp;
                <input type="hidden" id="date3" name="date3">
                <input type="text" id="date3_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
            </ul>
            <ul>Date 4:&nbsp;&nbsp;&nbsp;
                <input type="hidden" id="date4" name="date4">
                <input type="text" id="date4_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
            </ul>
            <ul>Date 5:&nbsp;&nbsp;&nbsp;
                <input type="hidden" id="date5" name="date5">
                <input type="text" id="date5_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
            </ul>
            <ul>Date 6:&nbsp;&nbsp;&nbsp;
                <input type="hidden" id="date6" name="date6">
                <input type="text" id="date6_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
            </ul>
            <ul>Date 7:&nbsp;&nbsp;&nbsp;
                <input type="hidden" id="date7" name="date7">
                <input type="text" id="date7_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
            </ul>
            <ul>Date 8:&nbsp;&nbsp;&nbsp;
                <input type="hidden" id="date8" name="date8">
                <input type="text" id="date8_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
            </ul>
            <ul>Date 9:&nbsp;&nbsp;&nbsp;
                <input type="hidden" id="date9" name="date9">
                <input type="text" id="date9_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
            </ul>
            <ul>Date 10:&nbsp;&nbsp;
                <input type="hidden" id="date10" name="date10">
                <input type="text" id="date10_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
            </ul>
            <ul>Date 11:&nbsp;&nbsp;
                <input type="hidden" id="date11" name="date11">
                <input type="text" id="date11_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
            </ul>
            <ul>Date 12:&nbsp;&nbsp;
                <input type="hidden" id="date12" name="date12">
                <input type="text" id="date12_visual" class="datetime-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date & Time">
            </ul>
            <br />

            <details>
                <summary><i style="color: gray;">Weekly Recurring Dates</i></summary>
                <i style="font-size: small;">If you select recurring dates you cannot use above <b>Individual Dates!</b></i><br /><br />
                
                Beginning Date:<br />
                <input type="hidden" id="date13" name="date13">
                <input type="text" id="date13_visual" class="date-only-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date"><br />
                
                End Date:<br />
                <input type="hidden" id="date14" name="date14">
                <input type="text" id="date14_visual" class="date-only-input" style="font-family: sans-serif;padding: 5px 10px; margin: 5px 0;" placeholder="Select Date"><br />
                
                Choose Time:<br />
                <input type="hidden" id="rectime" name="rectime">
                <input type="text" id="rectime_visual" class="time-input" style="padding: 5px 10px; margin: 5px 0;" placeholder="Select Time"><br /> <br />
                
                Choose Recurring Day(s):
                <div class="weekDays-selector">
                    <input type="checkbox" id="mon" name="mon" class="weekday" />
                    <label for="mon">M</label>
                    <input type="checkbox" id="tue" name="tue" class="weekday" />
                    <label for="tue">T</label>
                    <input type="checkbox" id="wed" name="wed" class="weekday" />
                    <label for="wed">W</label>
                    <input type="checkbox" id="thu" name="thu" class="weekday" />
                    <label for="thu">T</label>
                    <input type="checkbox" id="fri" name="fri" class="weekday" />
                    <label for="fri">F</label>
                </div>
            </details>
        </details>
        <br />
    </div>

    <label for="message" style="color: black;font-weight: bold;">Aqua Employee Guest is Visiting (Full Name)</label>
    <textarea id="message" name="message" placeholder="Enter Aqua Employee Full Name" style="height: 30px;font-family: sans-serif;text-transform: uppercase;"></textarea>
    
    <canvas id="qrcode"></canvas>

    <span id="emaillink" style="color: black;font-weight: bold;"></span><br>
    <span id="remove" style="color: black;font-weight: bold;font-size: small;"></span><br>
    <span id="removeYes" style="color: black;font-weight: bold;font-size: 12px;"></span>
    <span id="removeNo" style="color: black;font-weight: bold;font-size: 12px;"></span>
</div>
		
   <button id="submit_msg" type="button" style="background-color: orangered;">Schedule Guest (All fields required!)</button>
         <button id="update_db" type="button" style="padding: 5px;">Update Visit</button>
	 <button id="checkin" type="button" style="padding: 50px;">Tap Here to Check-In/Out</button>
        <button id="get_id" type="button" style="background-color: navy;">View Scheduled Visits</button>
       <button id="get_msg" type="button" style="background-color: cornflowerblue;">Go Home</button>
      <br>
      <center>
	       <label id="reset" style="color: black;font-weight: bold;font-size: 18px;"></label><br><br>
       <button id="get_id2" type="button" style="display: block;width: fit-content;background-color: gray;">**View Inactive Scheduled Visits</button>
      </center>
    </form>
      
            </div>
       
    <div id="table"></div>
          <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-firestore.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.0/jquery-ui.min.js"></script> 

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js"></script>

      <script src="aqua.js"></script>
<script src="popup.js"></script>
  </body>
    </div>
</html>
<script type="text/javascript"> 
// detect user agent
	 var ua = navigator.userAgent;
         var isMobile = /Android|webOS|iPhone|iPad|iPod/i.test(ua);
	var isIPadPro = /Macintosh/.test(navigator.userAgent) && 'ontouchend' in document;
        console.log("Is mobile?: " + isMobile);
	  console.log("Is iPad Pro?: " + isIPadPro);
	  if (isMobile || isIPadPro) {
	      document.getElementById("help").style.display = "none"
	      //alert("on mobile: " + navigator.platform); // display the platform you're on.
	      var userAgent = navigator.userAgent.toLowerCase();
	      console.log("Device Type:" + userAgent);
	  } 

    // --- XDSOFT DATETIMEPICKER CONFIGURATION ---

    var centralTimeString = new Date().toLocaleString("en-US", {timeZone: "America/Chicago"});
    var centralDate = new Date(centralTimeString);
    
    // Generate 24hr times 06:00 to 18:00
    var allowedTimes = [];
    for (var h = 7; h <= 18; h++) {
        var hourString = h < 10 ? '0' + h : h;
        allowedTimes.push(hourString + ':00');
        if (h < 18) { 
            allowedTimes.push(hourString + ':15');
            allowedTimes.push(hourString + ':30');
            allowedTimes.push(hourString + ':45');
        }
    }

  // 1. STANDARD DATE+TIME INPUTS
    $('.datetime-input').datetimepicker({
        format: 'm/d/Y h:i A',
        formatTime: 'h:i A',
        allowTimes: allowedTimes,
        step: 15,
        defaultDate: centralDate,
        startDate: centralDate,
        // --- Generate Button with CLASS ONLY (No Inline Styles) ---
        onGenerate: function(ct, $input) {
            var $this = $(this);
            if ($this.find('.xdsoft_clear_btn').length === 0) {
                // We create the div with just the class. CSS handles the look.
                var $btn = $('<div class="xdsoft_clear_btn">Clear Date & Time</div>');
                
                $btn.click(function() {
                    $input.val(''); 
                    var hiddenInputId = $input.attr('id').replace('_visual', '');
                    $('#' + hiddenInputId).val(''); 
                    $this.hide(); 
                });
                
                $this.append($btn);
            }
        },
        onChangeDateTime: function(dp, $input) {
            var hiddenInputId = $input.attr('id').replace('_visual', '');
            if(dp) {
                var isoDate = moment(dp).format("YYYY-MM-DDTHH:mm");
                $('#' + hiddenInputId).val(isoDate);
            } else {
                $('#' + hiddenInputId).val('');
            }
        }
    });

    // 2. DATE ONLY INPUTS
    $('.date-only-input').datetimepicker({
        timepicker: false,
        format: 'm/d/Y',
        defaultDate: centralDate,
        startDate: centralDate,
        onGenerate: function(ct, $input) {
            var $this = $(this);
            if ($this.find('.xdsoft_clear_btn').length === 0) {
                var $btn = $('<div class="xdsoft_clear_btn">Clear Date</div>');
                
                $btn.click(function() {
                    $input.val(''); 
                    var hiddenInputId = $input.attr('id').replace('_visual', '');
                    $('#' + hiddenInputId).val('');
                    $this.hide();
                });
                
                $this.append($btn);
            }
        },
        onChangeDateTime: function(dp, $input) {
            var hiddenInputId = $input.attr('id').replace('_visual', '');
            if(dp) {
                var isoDate = moment(dp).format("YYYY-MM-DD");
                $('#' + hiddenInputId).val(isoDate);
            } else {
                $('#' + hiddenInputId).val('');
            }
        }
    });

    // 3. TIME ONLY INPUT
    $('.time-input').datetimepicker({
        datepicker: false,
        format: 'h:i A',
        formatTime: 'h:i A',
        allowTimes: allowedTimes,
        step: 15,
        defaultDate: centralDate,
        startDate: centralDate,
        onGenerate: function(ct, $input) {
            var $this = $(this);
            if ($this.find('.xdsoft_clear_btn').length === 0) {
                var $btn = $('<div class="xdsoft_clear_btn">Clear Time</div>');
                
                $btn.click(function() {
                    $input.val(''); 
                    var hiddenInputId = $input.attr('id').replace('_visual', '');
                    $('#' + hiddenInputId).val('');
                    $this.hide();
                });
                
                $this.append($btn);
            }
        },
        onChangeDateTime: function(dp, $input) {
            var hiddenInputId = $input.attr('id').replace('_visual', '');
            if(dp) {
                var isoTime = moment(dp).format("HH:mm");
                $('#' + hiddenInputId).val(isoTime);
            } else {
                $('#' + hiddenInputId).val('');
            }
        }
    });
    // --- INTERCEPTOR: POPULATE VISUAL FIELDS WHEN AQUA.JS LOADS DATA ---
    // Since aqua.js populates hidden fields (e.g. "date") asynchronously,
    // we use Object.defineProperty to intercept when aqua.js sets .value
    // and immediately update the visual field (e.g. "date_visual").

    var dateFields = [
        'date', 'date2', 'date3', 'date4', 'date5', 'date6', 
        'date7', 'date8', 'date9', 'date10', 'date11', 'date12', 
        'date13', 'date14', 'rectime'
    ];

    dateFields.forEach(function(id) {
        var hiddenInput = document.getElementById(id);
        var visualInput = document.getElementById(id + '_visual');
        
        if (hiddenInput && visualInput) {
            // Get the original property descriptor for 'value' on the input prototype
            var descriptor = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');
            
            // Override the setter for this specific hidden input
            Object.defineProperty(hiddenInput, 'value', {
                set: function(val) {
                    // 1. Call the original setter to actually update the hidden input
                    descriptor.set.call(this, val);
                    
                    // 2. Format and update the visual input
                    if (val) {
                        var formatted = '';
                        // Determine format based on field type
                        if(id === 'rectime') {
                             // Assuming stored as HH:mm (24h)
                             formatted = moment(val, "HH:mm").format("h:mm A");
                        } else if (id === 'date13' || id === 'date14') {
                             // Assuming stored as YYYY-MM-DD
                             formatted = moment(val).format("MM/DD/YYYY");
                        } else {
                             // Standard DateTime, assuming ISO string
                             formatted = moment(val).format("MM/DD/YYYY h:mm A");
                        }
                        
                        if (formatted !== 'Invalid date') {
                            visualInput.value = formatted;
                        }
                    } else {
                        visualInput.value = '';
                    }
                },
                get: function() {
                    return descriptor.get.call(this);
                }
            });
        }
    });

</script> 
	<script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js">
</script>
<script type="text/javascript">
   (function(){
      emailjs.init("fxGG0I_OLtZPd1zPM");
   })();
</script>